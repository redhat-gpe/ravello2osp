heat_template_version: 2016-10-14
description: Create a project
parameters:
  public_net_id:
    type: string
    description: The ID for the floating ip
  project_name:
    type: string
    description: Name of the project for the flavors
  project_guid: 
    type: string
  api_user:
    type: string
    default: ""
    description: User for API calls (i.e. ipmi)
  api_pass:
    type: string
    default: ""
    description: Password for API user
  api_url:
    type: string
    default: ""
    description: OSP URL for API calls
 
resources:
  openstack_project_infra_key:
    type: OS::Nova::KeyPair
    properties:
      name:
        str_replace:
          template: $project$-infra_key
          params:
             $project$: { get_param: project_guid }
      save_private_key: true
  Network0_network:
    type: OS::Neutron::Net
    properties:
      name: "Network0"
      shared: false
      value_specs: {"mtu": 1500}
  Network1_network:
    type: OS::Neutron::Net
    properties:
      name: "Network1"
      shared: false
      value_specs: {"mtu": 1500}
  Network2_network:
    type: OS::Neutron::Net
    properties:
      name: "Network2"
      shared: false
      value_specs: {"mtu": 1500}
  Network3_network:
    type: OS::Neutron::Net
    properties:
      name: "Network3"
      shared: false
      value_specs: {"mtu": 1500}
  Network1_subnet:
    type: OS::Neutron::Subnet
    properties:
      name: "sub-Network1"
      network_id: { get_resource: Network1_network }
      cidr: "10.10.0.0/16"
      gateway_ip: "10.10.0.2"
      enable_dhcp: "True"
      
      allocation_pools: [{"start": 10.10.0.3, "end": 10.10.255.254}]
      
      dns_nameservers:
      
        - 10.10.0.1
      
        - 8.8.8.8
  Network2_subnet:
    type: OS::Neutron::Subnet
    properties:
      name: "sub-Network2"
      network_id: { get_resource: Network2_network }
      cidr: "10.1.0.0/16"
      gateway_ip: "10.1.0.2"
      enable_dhcp: "False"
      
      dns_nameservers:
      
        - 10.10.0.1
      
        - 8.8.8.8
  Network3_subnet:
    type: OS::Neutron::Subnet
    properties:
      name: "sub-Network3"
      network_id: { get_resource: Network3_network }
      cidr: "172.25.252.0/24"
      gateway_ip: ""
      enable_dhcp: "False"
      
      dns_nameservers:
      
        - 10.10.0.1
      
        - 8.8.8.8
  Network0_subnet:
    type: OS::Neutron::Subnet
    properties:
      name: "sub-Network0"
      network_id: { get_resource: Network0_network }
      cidr: "172.25.250.0/24"
      gateway_ip: "172.25.250.1"
      enable_dhcp: "True"
      
      allocation_pools: [{"start": 172.25.250.3, "end": 172.25.250.253}]
      
      dns_nameservers:
      
        - 10.10.0.1
      
        - 8.8.8.8
  Router0_router:
    type: OS::Neutron::Router
    properties:
      name: "Router0"
      external_gateway_info: { "network": { get_param: public_net_id } }

  
  Router0_Network1_port:
    type: OS::Neutron::Port
    properties:
      network: { get_resource: Network1_network }
      fixed_ips:
        - ip_address: "10.10.0.2"
  
  Router0_Network2_port:
    type: OS::Neutron::Port
    properties:
      network: { get_resource: Network2_network }
      fixed_ips:
        - ip_address: "10.1.0.2"
  
  Router0_Network0_port:
    type: OS::Neutron::Port
    properties:
      network: { get_resource: Network0_network }
      fixed_ips:
        - ip_address: "172.25.250.1"
  


  
  Router0_Network1_router_if:
    type: OS::Neutron::RouterInterface
    properties:
        router: { get_resource: Router0_router }
        port: { get_resource: Router0_Network1_port }
  
  Router0_Network2_router_if:
    type: OS::Neutron::RouterInterface
    properties:
        router: { get_resource: Router0_router }
        port: { get_resource: Router0_Network2_port }
  
  Router0_Network0_router_if:
    type: OS::Neutron::RouterInterface
    properties:
        router: { get_resource: Router0_router }
        port: { get_resource: Router0_Network0_port }
  
  0bastion_services_sg:
    type: OS::Neutron::SecurityGroup
    properties:
      name: 0bastion_services_sg
      rules:
      
      - {port_range_max: 22, port_range_min: 22, protocol: tcp, remote_ip_prefix: 0.0.0.0/0}
      
      - {port_range_max: 65535, port_range_min: 1, protocol: tcp, remote_ip_prefix: 10.10.10.100/255.255.0.0}
      
      - {port_range_max: 65535, port_range_min: 1, protocol: udp, remote_ip_prefix: 10.10.10.100/255.255.0.0}
      
      - {port_range_max: 65535, port_range_min: 1, protocol: tcp, remote_ip_prefix: 10.1.1.11/255.255.0.0}
      
      - {port_range_max: 65535, port_range_min: 1, protocol: udp, remote_ip_prefix: 10.1.1.11/255.255.0.0}
      
      - {port_range_max: 65535, port_range_min: 1, protocol: tcp, remote_ip_prefix: 172.25.252.0/255.255.255.0}
      
      - {port_range_max: 65535, port_range_min: 1, protocol: udp, remote_ip_prefix: 172.25.252.0/255.255.255.0}
      
      - {port_range_max: 65535, port_range_min: 1, protocol: tcp, remote_ip_prefix: 172.25.250.0/255.255.255.0}
      
      - {port_range_max: 65535, port_range_min: 1, protocol: udp, remote_ip_prefix: 172.25.250.0/255.255.255.0}
      
  1tower_services_sg:
    type: OS::Neutron::SecurityGroup
    properties:
      name: 1tower_services_sg
      rules:
      
      - {port_range_max: 80, port_range_min: 80, protocol: tcp, remote_ip_prefix: 0.0.0.0/0}
      
      - {port_range_max: 443, port_range_min: 443, protocol: tcp, remote_ip_prefix: 0.0.0.0/0}
      
      - {port_range_max: 65535, port_range_min: 1, protocol: tcp, remote_ip_prefix: 10.10.10.100/255.255.0.0}
      
      - {port_range_max: 65535, port_range_min: 1, protocol: udp, remote_ip_prefix: 10.10.10.100/255.255.0.0}
      
      - {port_range_max: 65535, port_range_min: 1, protocol: tcp, remote_ip_prefix: 10.1.1.11/255.255.0.0}
      
      - {port_range_max: 65535, port_range_min: 1, protocol: udp, remote_ip_prefix: 10.1.1.11/255.255.0.0}
      
      - {port_range_max: 65535, port_range_min: 1, protocol: tcp, remote_ip_prefix: 172.25.252.0/255.255.255.0}
      
      - {port_range_max: 65535, port_range_min: 1, protocol: udp, remote_ip_prefix: 172.25.252.0/255.255.255.0}
      
      - {port_range_max: 65535, port_range_min: 1, protocol: tcp, remote_ip_prefix: 172.25.250.0/255.255.255.0}
      
      - {port_range_max: 65535, port_range_min: 1, protocol: udp, remote_ip_prefix: 172.25.250.0/255.255.255.0}
      
  0bastion-0_port:
    type: OS::Neutron::Port
    properties:
      network: { get_resource: Network1_network }
      mac_address: "2c:c2:60:33:a7:84"
      
      security_groups:
        - 0bastion_services_sg
      
      
      fixed_ips:
        - {subnet: {get_resource: Network1_subnet}, ip_address: "10.10.10.100"}
      
    
    depends_on:
      
      
      - 0bastion_services_sg
      
    
  0bastion-0_fip:
    type: OS::Neutron::FloatingIP
    depends_on:
      - 0bastion_server
    properties:
      floating_network_id: { get_param: public_net_id }
      port_id: { get_resource: 0bastion-0_port }
  0bastion-1_port:
    type: OS::Neutron::Port
    properties:
      network: { get_resource: Network0_network }
      mac_address: "2c:c2:60:13:dc:cc"
      
      security_groups:
        - 0bastion_services_sg
      
      
      fixed_ips:
        - {subnet: {get_resource: Network0_subnet}, ip_address: "172.25.250.100"}
      
    
    depends_on:
      
      
      - 0bastion_services_sg
      
    
  3servera-0_port:
    type: OS::Neutron::Port
    properties:
      network: { get_resource: Network0_network }
      mac_address: "52:54:00:00:FA:0A"
      
      port_security_enabled: false
      
      
      fixed_ips:
        - {subnet: {get_resource: Network0_subnet}, ip_address: "172.25.250.10"}
      
    
  4classroom-0_port:
    type: OS::Neutron::Port
    properties:
      network: { get_resource: Network3_network }
      mac_address: "52:54:00:00:00:fe"
      
      port_security_enabled: false
      
      
      fixed_ips:
        - {subnet: {get_resource: Network3_subnet}, ip_address: "172.25.252.254"}
      
    
  4classroom-1_port:
    type: OS::Neutron::Port
    properties:
      network: { get_resource: Network2_network }
      mac_address: "2c:c2:60:2d:6b:f2"
      
      port_security_enabled: false
      
      
      fixed_ips:
        - {subnet: {get_resource: Network2_subnet}, ip_address: "10.1.1.11"}
      
    
  4utility-0_port:
    type: OS::Neutron::Port
    properties:
      network: { get_resource: Network0_network }
      mac_address: "52:54:00:00:FA:08"
      
      port_security_enabled: false
      
      
      fixed_ips:
        - {subnet: {get_resource: Network0_subnet}, ip_address: "172.25.250.8"}
      
    
  2workstation-0_port:
    type: OS::Neutron::Port
    properties:
      network: { get_resource: Network0_network }
      mac_address: "52:54:00:00:FA:FE"
      
      port_security_enabled: false
      
      
      fixed_ips:
        - {subnet: {get_resource: Network0_subnet}, ip_address: "172.25.250.254"}
      
    
  2workstation-1_port:
    type: OS::Neutron::Port
    properties:
      network: { get_resource: Network3_network }
      mac_address: "52:54:00:01:FC:01"
      
      port_security_enabled: false
      
      
      fixed_ips:
        - {subnet: {get_resource: Network3_subnet}, ip_address: "172.25.252.1"}
      
    
  3serverb-0_port:
    type: OS::Neutron::Port
    properties:
      network: { get_resource: Network0_network }
      mac_address: "52:54:00:00:FA:0B"
      
      port_security_enabled: false
      
      
      fixed_ips:
        - {subnet: {get_resource: Network0_subnet}, ip_address: "172.25.250.11"}
      
    
  3servere-0_port:
    type: OS::Neutron::Port
    properties:
      network: { get_resource: Network0_network }
      mac_address: "52:54:00:00:FA:0E"
      
      port_security_enabled: false
      
      
      fixed_ips:
        - {subnet: {get_resource: Network0_subnet}, ip_address: "172.25.250.14"}
      
    
  3serverc-0_port:
    type: OS::Neutron::Port
    properties:
      network: { get_resource: Network0_network }
      mac_address: "52:54:00:00:FA:0C"
      
      port_security_enabled: false
      
      
      fixed_ips:
        - {subnet: {get_resource: Network0_subnet}, ip_address: "172.25.250.12"}
      
    
  1tower-0_port:
    type: OS::Neutron::Port
    properties:
      network: { get_resource: Network0_network }
      mac_address: "52:54:00:00:FA:09"
      
      security_groups:
        - 1tower_services_sg
      
      
      fixed_ips:
        - {subnet: {get_resource: Network0_subnet}, ip_address: "172.25.250.9"}
      
    
    depends_on:
      
      
      - 1tower_services_sg
      
    
  1tower-0_fip:
    type: OS::Neutron::FloatingIP
    depends_on:
      - 1tower_server
    properties:
      floating_network_id: { get_param: public_net_id }
      port_id: { get_resource: 1tower-0_port }
  3serverf-0_port:
    type: OS::Neutron::Port
    properties:
      network: { get_resource: Network0_network }
      mac_address: "52:54:00:00:FA:0F"
      
      port_security_enabled: false
      
      
      fixed_ips:
        - {subnet: {get_resource: Network0_subnet}, ip_address: "172.25.250.15"}
      
    
  3serverd-0_port:
    type: OS::Neutron::Port
    properties:
      network: { get_resource: Network0_network }
      mac_address: "52:54:00:00:FA:0D"
      
      port_security_enabled: false
      
      
      fixed_ips:
        - {subnet: {get_resource: Network0_subnet}, ip_address: "172.25.250.13"}
      
    
  0bastion_server:
    type: OS::Nova::Server
    properties:
      name: "0bastion"
      
      image: "dev-ansible-tower-implementation-3.3-v6-0bastion-vol1"
      
      config_drive: True
      flavor:
         list_join: ['-', [{ get_param: project_name }, "CPU_1_Memory_2048_Disk_10"]]

      
      key_name:  { get_resource: openstack_project_infra_key }
      
      metadata: 
        "guid": { get_param: project_guid }
        "description": ""
        "hostname": 
          str_replace:
            template: "bastion-REPL"
            params:
              REPL: {get_param: project_guid}
        
        "AnsibleGroup": bastions
        
         
        
      personality: {"/etc/cloud/cloud.cfg.d/99-custom-networking.cfg": "network: {config: disabled}\n"}
      user_data_format: RAW
      user_data:
        str_replace:
          template: |
          
            #cloud-config
            hostname: bastion-REPL.rhpds.opentlc.com
          
          params:
            REPL: {get_param: project_guid}
            
      networks:
        
        - port: { get_resource: 0bastion-0_port}
        
        - port: { get_resource: 0bastion-1_port}
        
      
    

  
  1tower_server:
    type: OS::Nova::Server
    properties:
      name: "1tower"
      
      image: "dev-ansible-tower-implementation-3.3-v6-1tower-vda"
      
      config_drive: True
      flavor:
         list_join: ['-', [{ get_param: project_name }, "CPU_2_Memory_4096_Disk_40"]]

      
      metadata: 
        "guid": { get_param: project_guid }
        "description": "satclient:true"
        "hostname": 
          str_replace:
            template: "tower-REPL"
            params:
              REPL: {get_param: project_guid}
        
         
        
      personality: {"/etc/cloud/cloud.cfg.d/99-custom-networking.cfg": "network: {config: disabled}\n"}
      user_data_format: RAW
      user_data:
        str_replace:
          template: |
          
            #cloud-config
            hostname: tower-REPL.rhpds.opentlc.com
          
          params:
            REPL: {get_param: project_guid}
            
      networks:
        
        - port: { get_resource: 1tower-0_port}
        
      
    

  
  2workstation_server:
    type: OS::Nova::Server
    properties:
      name: "2workstation"
      
      image: "dev-ansible-tower-implementation-3.3-v6-2workstation-vda"
      
      config_drive: True
      flavor:
         list_join: ['-', [{ get_param: project_name }, "CPU_2_Memory_2048_Disk_10"]]

      
      metadata: 
        "guid": { get_param: project_guid }
        "description": ""
        "hostname": 
          str_replace:
            template: "workstation"
            params:
              REPL: {get_param: project_guid}
        
         
        
      personality: {"/etc/cloud/cloud.cfg.d/99-custom-networking.cfg": "network: {config: disabled}\n"}
      user_data_format: RAW
      user_data:
        str_replace:
          template: |
          
            #cloud-config
            hostname: workstation
          
          params:
            REPL: {get_param: project_guid}
            
      networks:
        
        - port: { get_resource: 2workstation-0_port}
        
        - port: { get_resource: 2workstation-1_port}
        
      
    

  
  3servera_server:
    type: OS::Nova::Server
    properties:
      name: "3servera"
      
      image: "dev-ansible-tower-implementation-3.3-v6-3servera-vda"
      
      config_drive: True
      flavor:
         list_join: ['-', [{ get_param: project_name }, "CPU_1_Memory_1024_Disk_10"]]

      
      metadata: 
        "guid": { get_param: project_guid }
        "description": ""
        "hostname": 
          str_replace:
            template: "servera"
            params:
              REPL: {get_param: project_guid}
        
         
        
      personality: {"/etc/cloud/cloud.cfg.d/99-custom-networking.cfg": "network: {config: disabled}\n"}
      user_data_format: RAW
      user_data:
        str_replace:
          template: |
          
            #cloud-config
            hostname: servera
          
          params:
            REPL: {get_param: project_guid}
            
      networks:
        
        - port: { get_resource: 3servera-0_port}
        
      
    

  
  3serverb_server:
    type: OS::Nova::Server
    properties:
      name: "3serverb"
      
      image: "dev-ansible-tower-implementation-3.3-v6-3serverb-vda"
      
      config_drive: True
      flavor:
         list_join: ['-', [{ get_param: project_name }, "CPU_1_Memory_1024_Disk_10"]]

      
      metadata: 
        "guid": { get_param: project_guid }
        "description": ""
        "hostname": 
          str_replace:
            template: "serverb"
            params:
              REPL: {get_param: project_guid}
        
         
        
      personality: {"/etc/cloud/cloud.cfg.d/99-custom-networking.cfg": "network: {config: disabled}\n"}
      user_data_format: RAW
      user_data:
        str_replace:
          template: |
          
            #cloud-config
            hostname: serverb
          
          params:
            REPL: {get_param: project_guid}
            
      networks:
        
        - port: { get_resource: 3serverb-0_port}
        
      
    

  
  3serverc_server:
    type: OS::Nova::Server
    properties:
      name: "3serverc"
      
      image: "dev-ansible-tower-implementation-3.3-v6-3serverc-vda"
      
      config_drive: True
      flavor:
         list_join: ['-', [{ get_param: project_name }, "CPU_1_Memory_1024_Disk_10"]]

      
      metadata: 
        "guid": { get_param: project_guid }
        "description": ""
        "hostname": 
          str_replace:
            template: "serverc"
            params:
              REPL: {get_param: project_guid}
        
         
        
      personality: {"/etc/cloud/cloud.cfg.d/99-custom-networking.cfg": "network: {config: disabled}\n"}
      user_data_format: RAW
      user_data:
        str_replace:
          template: |
          
            #cloud-config
            hostname: serverc
          
          params:
            REPL: {get_param: project_guid}
            
      networks:
        
        - port: { get_resource: 3serverc-0_port}
        
      
    

  
  3serverd_server:
    type: OS::Nova::Server
    properties:
      name: "3serverd"
      
      image: "dev-ansible-tower-implementation-3.3-v6-3serverd-vda"
      
      config_drive: True
      flavor:
         list_join: ['-', [{ get_param: project_name }, "CPU_1_Memory_1024_Disk_10"]]

      
      metadata: 
        "guid": { get_param: project_guid }
        "description": ""
        "hostname": 
          str_replace:
            template: "serverd"
            params:
              REPL: {get_param: project_guid}
        
         
        
      personality: {"/etc/cloud/cloud.cfg.d/99-custom-networking.cfg": "network: {config: disabled}\n"}
      user_data_format: RAW
      user_data:
        str_replace:
          template: |
          
            #cloud-config
            hostname: serverd
          
          params:
            REPL: {get_param: project_guid}
            
      networks:
        
        - port: { get_resource: 3serverd-0_port}
        
      
    

  
  3servere_server:
    type: OS::Nova::Server
    properties:
      name: "3servere"
      
      image: "dev-ansible-tower-implementation-3.3-v6-3servere-vda"
      
      config_drive: True
      flavor:
         list_join: ['-', [{ get_param: project_name }, "CPU_1_Memory_1024_Disk_10"]]

      
      metadata: 
        "guid": { get_param: project_guid }
        "description": ""
        "hostname": 
          str_replace:
            template: "servere"
            params:
              REPL: {get_param: project_guid}
        
         
        
      personality: {"/etc/cloud/cloud.cfg.d/99-custom-networking.cfg": "network: {config: disabled}\n"}
      user_data_format: RAW
      user_data:
        str_replace:
          template: |
          
            #cloud-config
            hostname: servere
          
          params:
            REPL: {get_param: project_guid}
            
      networks:
        
        - port: { get_resource: 3servere-0_port}
        
      
    

  
  3serverf_server:
    type: OS::Nova::Server
    properties:
      name: "3serverf"
      
      image: "dev-ansible-tower-implementation-3.3-v6-3serverf-vda"
      
      config_drive: True
      flavor:
         list_join: ['-', [{ get_param: project_name }, "CPU_1_Memory_1024_Disk_10"]]

      
      metadata: 
        "guid": { get_param: project_guid }
        "description": ""
        "hostname": 
          str_replace:
            template: "serverf"
            params:
              REPL: {get_param: project_guid}
        
         
        
      personality: {"/etc/cloud/cloud.cfg.d/99-custom-networking.cfg": "network: {config: disabled}\n"}
      user_data_format: RAW
      user_data:
        str_replace:
          template: |
          
            #cloud-config
            hostname: serverf
          
          params:
            REPL: {get_param: project_guid}
            
      networks:
        
        - port: { get_resource: 3serverf-0_port}
        
      
    

  
  4classroom_server:
    type: OS::Nova::Server
    properties:
      name: "4classroom"
      
      image: "dev-ansible-tower-implementation-3.3-v6-4classroom-vda"
      
      config_drive: True
      flavor:
         list_join: ['-', [{ get_param: project_name }, "CPU_2_Memory_2048_Disk_50"]]

      
      metadata: 
        "guid": { get_param: project_guid }
        "description": ""
        "hostname": 
          str_replace:
            template: "instructor"
            params:
              REPL: {get_param: project_guid}
        
         
        
      personality: {"/etc/cloud/cloud.cfg.d/99-custom-networking.cfg": "network: {config: disabled}\n"}
      user_data_format: RAW
      user_data:
        str_replace:
          template: |
          
            #cloud-config
            hostname: instructor
          
          params:
            REPL: {get_param: project_guid}
            
      networks:
        
        - port: { get_resource: 4classroom-0_port}
        
        - port: { get_resource: 4classroom-1_port}
        
      
    

  
  4utility_server:
    type: OS::Nova::Server
    properties:
      name: "4utility"
      
      image: "dev-ansible-tower-implementation-3.3-v6-4utility-vda"
      
      config_drive: True
      flavor:
         list_join: ['-', [{ get_param: project_name }, "CPU_2_Memory_2048_Disk_10"]]

      
      metadata: 
        "guid": { get_param: project_guid }
        "description": ""
        "hostname": 
          str_replace:
            template: "utility"
            params:
              REPL: {get_param: project_guid}
        
         
        
      personality: {"/etc/cloud/cloud.cfg.d/99-custom-networking.cfg": "network: {config: disabled}\n"}
      user_data_format: RAW
      user_data:
        str_replace:
          template: |
          
            #cloud-config
            hostname: utility
          
          params:
            REPL: {get_param: project_guid}
            
      networks:
        
        - port: { get_resource: 4utility-0_port}
        
      
    

  
  dns_servers:
    type: OS::Heat::Value
    properties:
      type: string
      value:
        list_join:
          - "\n"
          - 
            - list_join: [' ', [{get_attr: [3serverf-0_port, fixed_ips, 0, ip_address]}, "serverf" ]]
            
            - list_join: [' ', [{get_attr: [3servere-0_port, fixed_ips, 0, ip_address]}, "servere" ]]
            
            - list_join: [' ', [{get_attr: [3serverd-0_port, fixed_ips, 0, ip_address]}, "serverd" ]]
            
            - list_join: [' ', [{get_attr: [3serverc-0_port, fixed_ips, 0, ip_address]}, "serverc" ]]
            
            - list_join: [' ', [{get_attr: [4utility-0_port, fixed_ips, 0, ip_address]}, "utility" ]]
            
            - list_join: [' ', [{get_attr: [2workstation-0_port, fixed_ips, 0, ip_address]}, "workstation" ]]
            
            - list_join: [' ', [{get_attr: [1tower-0_port, fixed_ips, 0, ip_address]}, "1tower" ]]
            
            - list_join: [' ', [{get_attr: [2workstation-0_port, fixed_ips, 0, ip_address]}, "2workstation" ]]
            
            - list_join: [' ', [{get_attr: [3serverf-0_port, fixed_ips, 0, ip_address]}, "3serverf" ]]
            
            - list_join: [' ', [{get_attr: [3servere-0_port, fixed_ips, 0, ip_address]}, "3servere" ]]
            
            - list_join: [' ', [{get_attr: [3serverd-0_port, fixed_ips, 0, ip_address]}, "3serverd" ]]
            
            - list_join: [' ', [{get_attr: [3serverc-0_port, fixed_ips, 0, ip_address]}, "3serverc" ]]
            
            - list_join: [' ', [{get_attr: [3serverb-0_port, fixed_ips, 0, ip_address]}, "3serverb" ]]
            
            - list_join: [' ', [{get_attr: [4classroom-0_port, fixed_ips, 0, ip_address]}, "instructor" ]]
            
            - list_join: [' ', [{get_attr: [0bastion-0_port, fixed_ips, 0, ip_address]}, "0bastion" ]]
            
            - list_join: [' ', [{get_attr: [3servera-0_port, fixed_ips, 0, ip_address]}, "3servera" ]]
            
            - list_join: [' ', [{get_attr: [4utility-0_port, fixed_ips, 0, ip_address]}, "4utility" ]]
            
            - list_join: [' ', [{get_attr: [4classroom-0_port, fixed_ips, 0, ip_address]}, "4classroom" ]]
            
            - list_join: [' ', [{get_attr: [3serverb-0_port, fixed_ips, 0, ip_address]}, "serverb" ]]
            
            - list_join: [' ', [{get_attr: [0bastion-0_port, fixed_ips, 0, ip_address]}, "bastion-REPL.rhpds.opentlc.com" ]]
            
            - list_join: [' ', [{get_attr: [3servera-0_port, fixed_ips, 0, ip_address]}, "servera" ]]
            
            - list_join: [' ', [{get_attr: [1tower-0_port, fixed_ips, 0, ip_address]}, "tower-REPL.rhpds.opentlc.com" ]]
            
            - list_join: [' ', [{get_attr: [1tower-0_port, fixed_ips, 0, ip_address]}, "tower" ]]
            
            - list_join: [' ', [{get_attr: [3serverf-0_port, fixed_ips, 0, ip_address]}, "serverf" ]]
            
            - list_join: [' ', [{get_attr: [3servere-0_port, fixed_ips, 0, ip_address]}, "servere" ]]
            
            - list_join: [' ', [{get_attr: [3serverd-0_port, fixed_ips, 0, ip_address]}, "serverd" ]]
            
            - list_join: [' ', [{get_attr: [3serverc-0_port, fixed_ips, 0, ip_address]}, "serverc" ]]
            
            - list_join: [' ', [{get_attr: [4utility-0_port, fixed_ips, 0, ip_address]}, "utility" ]]
            
            - list_join: [' ', [{get_attr: [2workstation-0_port, fixed_ips, 0, ip_address]}, "workstation" ]]
            
            - list_join: [' ', [{get_attr: [1tower-0_port, fixed_ips, 0, ip_address]}, "1tower" ]]
            
            - list_join: [' ', [{get_attr: [2workstation-0_port, fixed_ips, 0, ip_address]}, "2workstation" ]]
            
            - list_join: [' ', [{get_attr: [3serverf-0_port, fixed_ips, 0, ip_address]}, "3serverf" ]]
            
            - list_join: [' ', [{get_attr: [3servere-0_port, fixed_ips, 0, ip_address]}, "3servere" ]]
            
            - list_join: [' ', [{get_attr: [3serverd-0_port, fixed_ips, 0, ip_address]}, "3serverd" ]]
            
            - list_join: [' ', [{get_attr: [3serverc-0_port, fixed_ips, 0, ip_address]}, "3serverc" ]]
            
            - list_join: [' ', [{get_attr: [3serverb-0_port, fixed_ips, 0, ip_address]}, "3serverb" ]]
            
            - list_join: [' ', [{get_attr: [4classroom-0_port, fixed_ips, 0, ip_address]}, "instructor" ]]
            
            - list_join: [' ', [{get_attr: [0bastion-0_port, fixed_ips, 0, ip_address]}, "0bastion" ]]
            
            - list_join: [' ', [{get_attr: [3servera-0_port, fixed_ips, 0, ip_address]}, "3servera" ]]
            
            - list_join: [' ', [{get_attr: [4utility-0_port, fixed_ips, 0, ip_address]}, "4utility" ]]
            
            - list_join: [' ', [{get_attr: [4classroom-0_port, fixed_ips, 0, ip_address]}, "4classroom" ]]
            
            - list_join: [' ', [{get_attr: [3serverb-0_port, fixed_ips, 0, ip_address]}, "serverb" ]]
            
            - list_join: [' ', [{get_attr: [0bastion-0_port, fixed_ips, 0, ip_address]}, "bastion-REPL.rhpds.opentlc.com" ]]
            
            - list_join: [' ', [{get_attr: [3servera-0_port, fixed_ips, 0, ip_address]}, "servera" ]]
            
            - list_join: [' ', [{get_attr: [1tower-0_port, fixed_ips, 0, ip_address]}, "tower-REPL.rhpds.opentlc.com" ]]
            
            - list_join: [' ', [{get_attr: [1tower-0_port, fixed_ips, 0, ip_address]}, "tower" ]]
            
  dnsserver_sg:
    type: OS::Neutron::SecurityGroup
    properties:
      name: dnsserver_sg
      rules:
      - {port_range_max: 53, port_range_min: 53, protocol: udp, remote_ip_prefix: "0.0.0.0/0"}

  dnsserver_server:
    type: OS::Nova::Server
    depends_on:
      - dnsserver_sg
    properties:
      name: "internaldns"
      image: "centos7"
      config_drive: True
      flavor: "m1.small"
      user_data_format: RAW
      user_data:
        str_replace:
          template: |
            #!/bin/sh
            echo "Start123" | passwd --stdin root
            echo nameserver 8.8.8.8 > /etc/resolv.conf
            echo "$hosts$" >> /etc/hosts
            sed -i "s/REPL/$GUID$/" /etc/hosts
            yum install -y dnsmasq
            systemctl enable --now dnsmasq
          params:
            "$hosts$": { get_attr: [dns_servers, value] }
            "$GUID$": { get_param: project_guid }
         
      security_groups: [dnsserver_sg]
      networks: 
       - network: { get_resource: Network1_network }
         fixed_ip: 10.10.0.1
outputs:
  openstack_project_infra_key:
    description: The SSH infra key
    value: {get_attr: [openstack_project_infra_key, private_key]}

  0bastion-0_fip:
    description: FIP for 0bastion-0
    value: {get_attr: [0bastion-0_fip, floating_ip_address ]} 


  1tower-0_fip:
    description: FIP for 1tower-0
    value: {get_attr: [1tower-0_fip, floating_ip_address ]} 


